<div [style]="{'display':openPopup()?'block':'none'}" class="modal fade show custom-filter-modal" tabindex="-1" role="dialog"
     aria-modal="true" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered" role="document">
    <div class="modal-content custom-modal-content">

      <div class="modal-header custom-modal-header">
        <h5 class="modal-title custom-modal-title card-header">
          <i class="bi bi-funnel-fill me-2"></i> Filtrer les Membres
        </h5>
        <button (click)="closeModal()" type="button" class="btn-close custom-btn-close" aria-label="Close"></button>
      </div>

      <div class="modal-body custom-modal-body">
        <form [formGroup]="formGroup">

          <div class="filter-section">
            <h6 class="filter-section-title"><i class="bi bi-sliders me-2"></i> Critères généraux</h6>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <div class="form-group custom-form-group">
                  <label for="commissionFilter" class="form-label">Commission</label>
                  <select id="commissionFilter" formControlName="commission" class="form-select custom-form-select">
                    <option value="">Toutes les commissions</option>
                    <ng-container *ngIf="commissions$ | async as commissions; else loading">
                      <option *ngFor="let commission of commissions.data" [value]="commission.id">
                        {{ commission.name }}
                      </option>
                    </ng-container>
                    <ng-template #loading>
                      <option disabled>Chargement...</option>
                    </ng-template>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group custom-form-group">
                  <label for="club" class="form-label">Club</label>
                  <select id="club" formControlName="club" class="form-select custom-form-select">
                    <option value="">Tous les clubs</option>
                    <ng-container *ngIf="clubs$ | async as clubs; else loadingClubs">
                      <option *ngFor="let club of clubs.data" [value]="club.id">{{ club.name }}</option>
                    </ng-container>
                    <ng-template #loadingClubs>
                      <option disabled>Chargement...</option>
                    </ng-template>
                  </select>
                </div>
              </div>
            </div>

            <div class="row g-3"> <div class="col-md-12"> <div class="form-group custom-form-group">
              <label for="yearFilter" class="form-label">Année de session</label>
              <select id="yearFilter" formControlName="year" class="form-select custom-form-select">
                <option value="">Toutes les années</option>
                <ng-container *ngIf="years$ | async as sessions; else loadingYears">
                  <option *ngFor="let year of sessions.data" [value]="year.id">{{ year.session }}</option>
                </ng-container>
                <ng-template #loadingYears>
                  <option disabled>Chargement...</option>
                </ng-template>
              </select>
            </div>
            </div>
            </div>
          </div>
          <div class="filter-section">
            <h6 class="filter-section-title"><i class="bi bi-calendar-check me-2"></i> Mois de cotisation</h6>
            <div class="row g-3">
              <div class="col-md-12">
                <div class="form-group custom-form-group">
                  <label for="cotisationMonth" class="form-label">Sélectionner le mois</label>
                  <select id="cotisationMonth" formControlName="cotisationMonth" class="form-select custom-form-select">
                    <option value="">Tous les mois</option>
                    <option *ngFor="let month of months" [value]="month.value">{{ month.name }}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="filter-section animate__animated animate__fadeIn" *ngIf="formGroup.get('cotisationMonth')?.value">
            <h6 class="filter-section-title"><i class="bi bi-wallet-fill me-2"></i> Statut de cotisation</h6>
            <div class="d-flex flex-wrap gap-3 custom-radio-group">
              <div class="form-check form-check-inline custom-radio-button">
                <input class="form-check-input" type="radio" name="cotisationStatus" id="cotisationAll" value=""
                       formControlName="cotisationStatus">
                <label class="form-check-label" for="cotisationAll">Tous les statuts</label>
              </div>
              <div class="form-check form-check-inline custom-radio-button">
                <input class="form-check-input" type="radio" name="cotisationStatus" id="cotisationPaid" value="PAID"
                       formControlName="cotisationStatus">
                <label class="form-check-label" for="cotisationPaid">Cotisé</label>
              </div>
              <div class="form-check form-check-inline custom-radio-button">
                <input class="form-check-input" type="radio" name="cotisationStatus" id="cotisationUnpaid"
                       value="UNPAID"
                       formControlName="cotisationStatus">
                <label class="form-check-label" for="cotisationUnpaid">Non cotisé</label>
              </div>
            </div>
          </div>
          <div class="filter-section">
            <h6 class="filter-section-title"><i class="bi bi-person-lines-fill me-2"></i> Type d'inscription</h6>
            <div class="d-flex flex-wrap gap-3 custom-radio-group">
              <div class="form-check form-check-inline custom-radio-button">
                <input class="form-check-input" type="radio" name="registrationFilterType" id="allRegistrations"
                       value=""
                       formControlName="registrationFilterType" (change)="onRegistrationFilterChange()">
                <label class="form-check-label" for="allRegistrations">Toutes les inscriptions</label>
              </div>
              <div class="form-check form-check-inline custom-radio-button">
                <input class="form-check-input" type="radio" name="registrationFilterType" id="specificRegistration"
                       value="specific"
                       formControlName="registrationFilterType" (change)="onRegistrationFilterChange()">
                <label class="form-check-label" for="specificRegistration">Type spécifique</label>
              </div>
            </div>

            <div *ngIf="formGroup.get('registrationFilterType')?.value === 'specific'"
                 class="form-group custom-form-group mt-3 animate__animated animate__fadeIn">
              <label for="specificRegistrationType" class="form-label">Sélectionner le type</label>
              <select id="specificRegistrationType" formControlName="specificRegistrationType"
                      class="form-select custom-form-select">
                <option value="">Sélectionner un type</option>
                <option value="INITIAL">Nouvelle inscription</option>
                <option value="REINSCRIPTION">Renouvellement</option>
              </select>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer custom-modal-footer">
        <button type="button" class="btn btn-outline-secondary custom-btn-cancel" (click)="closeModal()">
          <i class="bi bi-x-circle me-2"></i> Annuler
        </button>
        <button type="button" class="btn btn-primary custom-btn-apply" (click)="applyFilters()">
          <i class="bi bi-check-circle-fill me-2"></i> Appliquer les filtres
        </button>
      </div>
    </div>
  </div>
</div>
