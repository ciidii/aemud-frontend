<div class="container my-5">
  <div class="card shadow-sm border-0 rounded mb-4">
    <div class="card-body d-flex align-items-center">
      <div>
        <h2 class="mb-1">{{ member.personalInfo.firstname }} {{ member.personalInfo.name }}</h2>
        <p class="text-muted mb-0">{{ member.membershipInfo.legacyInstitution }}</p>
        <p class="text-muted">{{ member.addressInfo.addressInDakar }}</p>
      </div>
    </div>
  </div>

  <ul class="nav nav-tabs nav-justified" id="profileTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="personal-tab"
        data-bs-toggle="tab"
        data-bs-target="#personalInfoContent"
        type="button"
        role="tab"
        aria-controls="personalInfoContent"
        aria-selected="true"
      >
        Résumé
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="membership-tab"
        data-bs-toggle="tab"
        data-bs-target="#membershipInfoContent"
        type="button"
        role="tab"
        aria-controls="membershipInfoContent"
        aria-selected="false"
      >
        Adhésion
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="academic-tab"
        data-bs-toggle="tab"
        data-bs-target="#academicInfoContent"
        type="button"
        role="tab"
        aria-controls="academicInfoContent"
        aria-selected="false"
      >
        Académique
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="contact-tab"
        data-bs-toggle="tab"
        data-bs-target="#emergencyContactContent"
        type="button"
        role="tab"
        aria-controls="emergencyContactContent"
        aria-selected="false"
      >
        Contact d'Urgence
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="registration-tab"
        data-bs-toggle="tab"
        data-bs-target="#registrationInfoContent"
        type="button"
        role="tab"
        aria-controls="registrationInfoContent"
        aria-selected="false"
      >
        Inscriptions
      </button>
    </li>
  </ul>

  <div class="tab-content border border-top-0 rounded-bottom p-4">
    <div
      class="tab-pane fade show active"
      id="personalInfoContent"
      role="tabpanel"
      aria-labelledby="personal-tab"
    >
      <div *ngIf="!isPersonalInfoEditing; else editPersonalInfo">
        <div class="row mb-3">
          <div class="col-md-6">
            <p class="mb-1"><strong>Prénom :</strong> {{ member.personalInfo.firstname }}</p>
            <p class="mb-1"><strong>Nom :</strong> {{ member.personalInfo.name }}</p>
            <p class="mb-1"><strong>Nationalité :</strong> {{ member.personalInfo.nationality }}</p>
          </div>
          <div class="col-md-6">
            <p class="mb-1"><strong>Date de naissance :</strong> {{ member.personalInfo.birthday[2] }}
              /{{ member.personalInfo.birthday[1] }}/{{ member.personalInfo.birthday[0] }}</p>
            <p class="mb-1"><strong>Situation Matrimoniale :</strong> {{ member.personalInfo.maritalStatus }}</p>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-6">
            <p class="mb-1"><strong>Email :</strong> {{ member.contactInfo.email }}</p>
          </div>
          <div class="col-md-6">
            <p class="mb-1"><strong>Téléphone :</strong> {{ member.contactInfo.numberPhone }}</p>
          </div>
        </div>
        <button class="btn btn-outline-primary mt-3" (click)="togglePersonalInfoInfo()">
          <i class="bi bi-pencil"></i> Modifier
        </button>
      </div>
      <ng-template #editPersonalInfo>
        <form [formGroup]="personalInfo" novalidate (ngSubmit)="onPersonalInfoChangeSave()">
          <div class="card mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0 text-center">Modifier Informations personnelles</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="name" class="form-label">Nom</label>
                  <input type="text" id="name" formControlName="name" class="form-control"
                         [ngClass]="{ 'is-invalid': personalInfo.get('name')?.invalid && personalInfo.get('name')?.touched }"
                         placeholder="Entrez votre nom"/>
                  <div *ngIf="personalInfo.get('name')?.invalid && personalInfo.get('name')?.touched"
                       class="invalid-feedback">
                    Le nom est requis et doit comporter au moins 2 caractères.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="firstname" class="form-label">Prénom</label>
                  <input type="text" id="firstname" formControlName="firstname" class="form-control"
                         [ngClass]="{ 'is-invalid': personalInfo.get('firstname')?.invalid && personalInfo.get('firstname')?.touched }"
                         placeholder="Entrez votre prénom"/>
                  <div *ngIf="personalInfo.get('firstname')?.invalid && personalInfo.get('firstname')?.touched"
                       class="invalid-feedback">
                    Le prénom est requis et doit comporter au moins 2 caractères.
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="nationality" class="form-label">Nationalité</label>
                  <input type="text" id="nationality" formControlName="nationality" class="form-control"
                         [ngClass]="{ 'is-invalid': personalInfo.get('nationality')?.invalid && personalInfo.get('nationality')?.touched }"
                         placeholder="Entrez votre nationalité"/>
                  <div *ngIf="personalInfo.get('nationality')?.invalid && personalInfo.get('nationality')?.touched"
                       class="invalid-feedback">
                    La nationalité est requise.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="birthday" class="form-label">Date de naissance</label>
                  <input type="date" id="birthday" formControlName="birthday" class="form-control"
                         [ngClass]="{ 'is-invalid': personalInfo.get('birthday')?.invalid && personalInfo.get('birthday')?.touched }"
                         [max]="maxDate"/>
                  <div *ngIf="personalInfo.get('birthday')?.invalid && personalInfo.get('birthday')?.touched"
                       class="invalid-feedback">
                    La date de naissance est requise.
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="maritalStatus" class="form-label">Situation Matrimoniale</label>
                <select id="maritalStatus" formControlName="maritalStatus" class="form-control">
                  <option value="" disabled>Sélectionnez</option>
                  <option value="SINGLE">Célibataire</option>
                  <option value="MARRIED">Marié</option>
                </select>
                <div *ngIf="personalInfo.get('maritalStatus')?.invalid && personalInfo.get('maritalStatus')?.touched"
                     class="invalid-feedback">
                  L'état civil est requis.
                </div>
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-end mt-3">
            <button [disabled]="!personalInfo.dirty" type="submit" class="btn btn-outline-primary me-2">Enregistrer</button>
            <button type="button" class="btn btn-secondary" (click)="togglePersonalInfoInfo()">Annuler</button>
          </div>
        </form>
      </ng-template>
    </div>

    <div
      class="tab-pane fade"
      id="membershipInfoContent"
      role="tabpanel"
      aria-labelledby="membership-tab"
    >
      <div *ngIf="!isEditingMembershipInfo; else editMembershipInfo">
        <div class="row mb-3">
          <div class="col-md-6">
            <p class="mb-1"><strong>Lycée de provenance :</strong> {{ member.membershipInfo.legacyInstitution }}</p>
            <p class="mb-1"><strong>Année du Bac :</strong> {{ member.membershipInfo.yearOfBac }}</p>
            <p class="mb-1"><strong>Série au Bac :</strong> {{ member.membershipInfo.bacSeries }}</p>
            <p class="mb-1"><strong>Mention au Bac :</strong> {{ member.membershipInfo.bacMention }}</p>
          </div>
          <div class="col-md-6">
            <p class="mb-1"><strong>Cours AEMUD suivis :</strong> {{ member.membershipInfo.aemudCourses }}</p>
            <p class="mb-1"><strong>Autres cours :</strong> {{ member.membershipInfo.otherCourses }}</p>
            <p class="mb-1"><strong>Activités AEMUD :</strong> {{ member.membershipInfo.participatedActivity }}</p>
            <p class="mb-1"><strong>Organisation politique :</strong> {{ member.membershipInfo.politicOrganisation }}
            </p>
            <p class="mb-1"><strong>Bourse :</strong> {{ member.bourse.lebelle || 'N/A' }}</p>
            <p class="mb-1"><strong>Commission :</strong> {{ member.commissions?.[0]?.name || 'N/A' }}</p>
            <p class="mb-1"><strong>Club :</strong> {{ member.clubs?.[0]?.name || 'N/A' }}</p>
          </div>
        </div>
        <button class="btn btn-outline-primary mt-3" (click)="toggleEditMembershipInfo()">
          <i class="bi bi-pencil"></i> Modifier
        </button>
      </div>
      <ng-template #editMembershipInfo>
        <form [formGroup]="membershipInfo" (ngSubmit)="onMembershipInfoSave()" novalidate>
          <div class="card mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0 text-center">Modifier Informations d'Adhésion</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="yearOfBac" class="form-label">Année de bac</label>
                  <input id="yearOfBac" formControlName="yearOfBac" class="form-control"
                         [ngClass]="{ 'is-invalid': membershipInfo.get('yearOfBac')?.invalid && membershipInfo.get('yearOfBac')?.touched }"
                         placeholder="Entrez l'année d'obtention du bac"/>
                  <div *ngIf="membershipInfo.get('yearOfBac')?.invalid && membershipInfo.get('yearOfBac')?.touched"
                       class="invalid-feedback">
                    L'année d'obtention du bac est requise.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="bacSeries" class="form-label">BAC: Série</label>
                  <select id="bacSeries" formControlName="bacSeries" class="form-control"
                          [ngClass]="{ 'is-invalid': membershipInfo.get('bacSeries')?.invalid && membershipInfo.get('bacSeries')?.touched }">
                    <option value="" disabled selected>-- Sélectionnez votre série --</option>
                    <option value="S1">Série S1</option>
                    <option value="S2">Série S2</option>
                    <option value="S3">Série S3</option>
                    <option value="L1">Série L'1</option>
                    <option value="L2">Série L2</option>
                    <option value="Technique">Technique</option>
                    <option value="G">Série G</option>
                  </select>
                  <div *ngIf="membershipInfo.get('bacSeries')?.invalid && membershipInfo.get('bacSeries')?.touched"
                       class="invalid-feedback">
                    Veuillez sélectionner une série valide pour votre BAC.
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="bacMention" class="form-label">BAC: Mention</label>
                  <select id="bacMention" formControlName="bacMention" class="form-control"
                          [ngClass]="{ 'is-invalid': membershipInfo.get('bacMention')?.invalid && membershipInfo.get('bacMention')?.touched }">
                    <option value="" disabled selected>-- Sélectionnez votre mention --</option>
                    <option value="Très Bien">Très Bien</option>
                    <option value="Bien">Bien</option>
                    <option value="Assez Bien">Assez Bien</option>
                    <option value="Passable">Passable</option>
                    <option value="Sans Mention">Sans Mention</option>
                  </select>
                  <div *ngIf="membershipInfo.get('bacMention')?.invalid && membershipInfo.get('bacMention')?.touched"
                       class="invalid-feedback">
                    Veuillez sélectionner une mention valide pour votre BAC.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="legacyInstitution" class="form-label">Etablissement d'origine</label>
                  <input id="legacyInstitution" formControlName="legacyInstitution" class="form-control"
                         [ngClass]="{ 'is-invalid': membershipInfo.get('legacyInstitution')?.invalid && membershipInfo.get('legacyInstitution')?.touched }"
                         placeholder="Entrez l'établissement d'origine"/>
                  <div
                    *ngIf="membershipInfo.get('legacyInstitution')?.invalid && membershipInfo.get('legacyInstitution')?.touched"
                    class="invalid-feedback">
                    L'Etablissement d'origine est obligatoire
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="aemudCourses" class="form-label">Cours AEMUD</label>
                  <input type="text" id="aemudCourses" formControlName="aemudCourses" class="form-control"
                         [ngClass]="{ 'is-invalid': membershipInfo.get('aemudCourses')?.invalid && membershipInfo.get('aemudCourses')?.touched }"
                         placeholder="Entrez les cours AEMUD"/>
                  <div
                    *ngIf="membershipInfo.get('aemudCourses')?.invalid && membershipInfo.get('aemudCourses')?.touched"
                    class="invalid-feedback">
                    Les cours AEMUD sont requis.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="otherCourses" class="form-label">Autres cours suivis</label>
                  <input type="text" id="otherCourses" formControlName="otherCourses" class="form-control"
                         [ngClass]="{ 'is-invalid': membershipInfo.get('otherCourses')?.invalid && membershipInfo.get('otherCourses')?.touched }"
                         placeholder="Entrez d'autres cours"/>
                  <div
                    *ngIf="membershipInfo.get('otherCourses')?.invalid && membershipInfo.get('otherCourses')?.touched"
                    class="invalid-feedback">
                    Les autres cours sont requis.
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="participatedActivity" class="form-label">Activité Participée</label>
                  <input type="text" id="participatedActivity" formControlName="participatedActivity"
                         class="form-control"
                         [ngClass]="{ 'is-invalid': membershipInfo.get('participatedActivity')?.invalid && membershipInfo.get('participatedActivity')?.touched }"
                         placeholder="Entrez l'activité participée"/>
                  <div
                    *ngIf="membershipInfo.get('participatedActivity')?.invalid && membershipInfo.get('participatedActivity')?.touched"
                    class="invalid-feedback">
                    L'activité est requise.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="politicOrganisation" class="form-label">Organisation Politique</label>
                  <input type="text" id="politicOrganisation" formControlName="politicOrganisation" class="form-control"
                         [ngClass]="{ 'is-invalid': membershipInfo.get('politicOrganisation')?.invalid && membershipInfo.get('politicOrganisation')?.touched }"
                         placeholder="Entrez l'organisation politique"/>
                  <div
                    *ngIf="membershipInfo.get('politicOrganisation')?.invalid && membershipInfo.get('politicOrganisation')?.touched"
                    class="invalid-feedback">
                    L'organisation politique est requise.
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="commission" class="form-label">Commission</label>
                  <select id="commission" formControlName="commission" class="form-control"
                          [ngClass]="{ 'is-invalid': membershipInfo.get('commission')?.invalid && membershipInfo.get('commission')?.touched }">
                    <option value="" disabled selected>Sélectionnez une commission</option>
                    <option *ngFor="let commission of commissions" value="{{commission.id}}">{{ commission.name }}
                    </option>
                  </select>
                  <div *ngIf="membershipInfo.get('commission')?.invalid && membershipInfo.get('commission')?.touched"
                       class="invalid-feedback">
                    La commission est requise.
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="clubs" class="form-label">Club</label>
                  <select id="clubs" formControlName="clubs" class="form-control"
                          [ngClass]="{ 'is-invalid': membershipInfo.get('clubs')?.invalid && membershipInfo.get('clubs')?.touched }">
                    <option value="" disabled selected>Sélectionnez un club</option>
                    <option *ngFor="let club of clubs" value="{{club.id}}">{{ club.name }}</option>
                  </select>
                  <div *ngIf="membershipInfo.get('clubs')?.invalid && membershipInfo.get('clubs')?.touched"
                       class="invalid-feedback">
                    Le club est requis.
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="bourse" class="form-label">Bourse</label>
                  <select id="bourse" formControlName="bourse" class="form-control"
                          [ngClass]="{ 'is-invalid': membershipInfo.get('bourse')?.invalid && membershipInfo.get('bourse')?.touched }">
                    <option value="" disabled selected>Sélectionnez une bourse</option>
                    <option *ngFor="let bourse of bourses" value="{{bourse.bourseId}}">{{ bourse.lebelle }}</option>
                  </select>
                  <div *ngIf="membershipInfo.get('bourse')?.invalid && membershipInfo.get('bourse')?.touched"
                       class="invalid-feedback">
                    La bourse est requise.
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-end mt-3">
            <button [disabled]="!membershipInfo.dirty" type="submit" class="btn btn-outline-primary me-2">Enregistrer</button>
            <button type="button" class="btn btn-secondary" (click)="toggleEditMembershipInfo()">Annuler</button>
          </div>
        </form>
      </ng-template>
    </div>

    <div
      class="tab-pane fade"
      id="academicInfoContent"
      role="tabpanel"
      aria-labelledby="academic-tab"
    >
      <div *ngIf="!isEditingAcademicInfo; else editAcademicInfo">
        <div class="row mb-3">
          <div class="col-md-6">
            <p class="mb-1"><strong>Université/Institut :</strong> {{ member.academicInfo.institutionName }}</p>
          </div>
          <div class="col-md-6">
            <p class="mb-1"><strong>Domaine d'études :</strong> {{ member.academicInfo.studiesDomain }}</p>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-12">
            <p class="mb-1"><strong>Niveau d'étude :</strong> {{ member.academicInfo.studiesLevel }}</p>
          </div>
        </div>
        <button (click)="toggleEditingAcademicInfo()" class="btn btn-outline-primary mt-3">
          <i class="bi bi-pencil"></i> Modifier
        </button>
      </div>
      <ng-template #editAcademicInfo>
        <form [formGroup]="academicInfo" (ngSubmit)="onAcademyInfoSaved()" novalidate>
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0 text-center">Modifier Informations Académiques</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="institutionName" class="form-label">Université</label>
                  <input type="text" id="institutionName" formControlName="institutionName" class="form-control"
                         [ngClass]="{ 'is-invalid': academicInfo.get('institutionName')?.invalid && academicInfo.get('institutionName')?.touched }"
                         placeholder="Nom de l'université"/>
                  <div
                    *ngIf="academicInfo.get('institutionName')?.invalid && academicInfo.get('institutionName')?.touched"
                    class="invalid-feedback">
                    Le nom de l'université est requis et doit comporter au moins 3 caractères.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="studiesDomain" class="form-label">Domaine d'études</label>
                  <input type="text" id="studiesDomain" formControlName="studiesDomain" class="form-control"
                         [ngClass]="{ 'is-invalid': academicInfo.get('studiesDomain')?.invalid && academicInfo.get('studiesDomain')?.touched }"
                         placeholder="Entrez le domaine d'études"/>
                  <div *ngIf="academicInfo.get('studiesDomain')?.invalid && academicInfo.get('studiesDomain')?.touched"
                       class="invalid-feedback">
                    Le domaine d'études est requis et doit comporter au moins 3 caractères.
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="studiesLevel" class="form-label">Niveau d'étude</label>
                <input type="text" id="studiesLevel" formControlName="studiesLevel" class="form-control"
                       [ngClass]="{ 'is-invalid': academicInfo.get('studiesLevel')?.invalid && academicInfo.get('studiesLevel')?.touched }"
                       placeholder="Entrez le niveau d'étude"/>
                <div *ngIf="academicInfo.get('studiesLevel')?.invalid && academicInfo.get('studiesLevel')?.touched"
                     class="invalid-feedback">
                  Le niveau d'étude est requis.
                </div>
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-end mt-3">
            <button [disabled]="!academicInfo.dirty" type="submit" class="btn btn-outline-primary me-2">Enregistrer</button>
            <button type="button" class="btn btn-secondary" (click)="toggleEditingAcademicInfo()">Annuler</button>
          </div>
        </form>
      </ng-template>
    </div>

    <div
      class="tab-pane fade"
      id="emergencyContactContent"
      role="tabpanel"
      aria-labelledby="contact-tab"
    >
      <div *ngIf="!isEditingContactInfo; else editContactInfo">
        <div class="mb-4">
          <h5 class="text-primary">Informations de Contact du Membre</h5>
          <p class="mb-1"><strong>Email :</strong> {{ member.contactInfo.email }}</p>
          <p class="mb-1"><strong>Téléphone :</strong> {{ member.contactInfo.numberPhone }}</p>
        </div>
        <h5 class="text-primary">Personnes à Contacter en Urgence</h5>
        <div
          *ngIf="member.contactInfo.personToCalls && member.contactInfo.personToCalls.length > 0; else noEmergencyContacts">
          <div *ngFor="let p of member.contactInfo.personToCalls; let i = index"
               class="card card-body mb-3 bg-light border-primary">
            <h6 class="mb-2 text-primary">Contact d'Urgence #{{ i + 1 }}</h6>
            <p class="mb-1"><strong>Relation :</strong> {{ p.relationship }}</p>
            <p class="mb-1"><strong>Nom complet :</strong> {{ p.firstname }} {{ p.lastname }}</p>
            <p class="mb-1"><strong>Téléphone principal :</strong> {{ p.requiredNumberPhone }}</p>
            <p class="mb-1"><strong>Téléphone secondaire :</strong> {{ p.optionalNumberPhone }}</p>
          </div>
        </div>
        <ng-template #noEmergencyContacts>
          <div class="alert alert-info" role="alert">
            Aucun contact d'urgence défini.
          </div>
        </ng-template>
        <button (click)="toggleEditingContactInfo()" class="btn btn-outline-primary mt-3">
          <i class="bi bi-pencil"></i> Modifier
        </button>
      </div>
      <ng-template #editContactInfo>
        <form [formGroup]="contactInfo" (ngSubmit)="onContactInfoSaved()">
          <div class="card mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0 text-center">Modifier Contact du Membre</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="numberPhone" class="form-label">Numéro de Téléphone</label>
                  <div class="input-group">
                    <span class="input-group-text">+221</span>
                    <input type="text" id="numberPhone" formControlName="numberPhone" class="form-control"
                           [ngClass]="{ 'is-invalid': contactInfo.get('numberPhone')?.invalid && contactInfo.get('numberPhone')?.touched }"
                           placeholder="XXXXXXXXX"/>
                  </div>
                  <div *ngIf="contactInfo.get('numberPhone')?.invalid && contactInfo.get('numberPhone')?.touched"
                       class="invalid-feedback">
                    Numéro de téléphone invalide. Format requis : 9 chiffres.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="email" class="form-label">Adresse Email</label>
                  <input type="email" id="email" formControlName="email" class="form-control"
                         [ngClass]="{ 'is-invalid': contactInfo.get('email')?.invalid && contactInfo.get('email')?.touched }"
                         placeholder="Entrez l'adresse email"/>
                  <div *ngIf="contactInfo.get('email')?.invalid && contactInfo.get('email')?.touched"
                       class="invalid-feedback">
                    Adresse email invalide.
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0 text-center">Modifier Personnes à Contacter en Urgence</h5>
            </div>
            <div class="card-body">
              <div *ngIf="personToCalls.controls.length > 0; else addFirstContact">
                <div formArrayName="personToCalls">
                  <div *ngFor="let person of personToCalls.controls; let i = index;" [formGroupName]="i"
                       class="mb-4 p-3 border rounded border-secondary bg-light">
                    <h6 class="text-secondary">Contact #{{ i + 1 }}</h6>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="lastname{{ i }}" class="form-label">Nom</label>
                        <input type="text" id="lastname{{ i }}" formControlName="lastname" class="form-control"
                               [ngClass]="{ 'is-invalid': person.get('lastname')?.invalid && person.get('lastname')?.touched }"
                               placeholder="Entrez le nom"/>
                        <div *ngIf="person.get('lastname')?.invalid && person.get('lastname')?.touched"
                             class="invalid-feedback">
                          Nom requis.
                        </div>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="firstname{{ i }}" class="form-label">Prénom</label>
                        <input type="text" id="firstname{{ i }}" formControlName="firstname" class="form-control"
                               [ngClass]="{ 'is-invalid': person.get('firstname')?.invalid && person.get('firstname')?.touched }"
                               placeholder="Entrez le prénom"/>
                        <div *ngIf="person.get('firstname')?.invalid && person.get('firstname')?.touched"
                             class="invalid-feedback">
                          Prénom requis.
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="requiredNumberPhone{{ i }}" class="form-label">Téléphone Principal</label>
                        <div class="input-group">
                          <span class="input-group-text">+221</span>
                          <input type="text" id="requiredNumberPhone{{ i }}" formControlName="requiredNumberPhone"
                                 class="form-control"
                                 [ngClass]="{ 'is-invalid': person.get('requiredNumberPhone')?.invalid && person.get('requiredNumberPhone')?.touched }"
                                 placeholder="XXXXXXXXX"/>
                        </div>
                        <div
                          *ngIf="person.get('requiredNumberPhone')?.invalid && person.get('requiredNumberPhone')?.touched"
                          class="invalid-feedback">
                          Téléphone principal invalide. Format requis : 9 chiffres.
                        </div>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="optionalNumberPhone{{ i }}" class="form-label">Téléphone Secondaire</label>
                        <div class="input-group">
                          <span class="input-group-text">+221</span>
                          <input type="text" id="optionalNumberPhone{{ i }}" formControlName="optionalNumberPhone"
                                 class="form-control"
                                 placeholder="XXXXXXXXX"/>
                        </div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="relationship{{ i }}" class="form-label">Relation</label>
                      <input type="text" id="relationship{{ i }}" formControlName="relationship" class="form-control"
                             placeholder="Entrez la relation"/>
                    </div>
                    <div class="d-flex justify-content-end">
                      <button type="button" class="btn btn-danger btn-sm" (click)="removePersonToCall(i)"
                              [disabled]="personToCalls.length === 1">
                        Supprimer ce contact
                      </button>
                    </div>
                    <hr *ngIf="i < personToCalls.controls.length - 1" class="my-3"/>
                  </div>
                </div>
              </div>
              <ng-template #addFirstContact>
                <div class="alert alert-warning text-center" role="alert">
                  Veuillez ajouter un contact d'urgence.
                </div>
              </ng-template>
              <button [disabled]="personToCalls.length >= 2" type="button" class="btn btn-outline-primary mt-3"
                      (click)="addPersonToCall()">
                <i class="bi bi-plus-circle"></i> Ajouter un contact d'urgence
              </button>
            </div>
          </div>
          <div class="d-flex justify-content-end mt-3">
            <button [disabled]="!contactInfo.dirty" type="submit" class="btn btn-outline-primary me-2">Enregistrer</button>
            <button type="button" class="btn btn-secondary" (click)="toggleEditingContactInfo()">Annuler</button>
          </div>
        </form>
      </ng-template>
    </div>

    <div
      class="tab-pane fade"
      id="registrationInfoContent"
      role="tabpanel"
      aria-labelledby="registration-tab"
    >
      <h4 class="mb-4 text-primary">Historique des Inscriptions</h4>
      <div *ngIf="member.registration && member.registration.length > 0; else noRegistrations">
        <div *ngFor="let reg of member.registration; let i = index" class="card mb-3 shadow-sm border-secondary">
          <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Inscription #{{ i + 1 }} - Session {{ reg.session }}</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p class="mb-1"><strong>Type d'inscription :</strong> {{ reg.registrationType }}</p>
                <p class="mb-1"><strong>Statut de l'inscription :</strong> <span
                  class="badge bg-info">{{ reg.registrationStatus }}</span></p>
              </div>
              <div class="col-md-6">
                <p class="mb-1">
                  <strong>Date d'inscription :</strong>
                  {{ reg.dateInscription[2] }}/{{ reg.dateInscription[1] }}/{{ reg.dateInscription[0] }}
                </p>
                <p class="mb-1">
                  <strong>Statut de paiement :</strong>
                  <span class="badge" [ngClass]="{'bg-success': reg.statusPayment, 'bg-danger': !reg.statusPayment}">
                    {{ reg.statusPayment ? 'Payé' : 'Non payé' }}
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noRegistrations>
        <div class="alert alert-info text-center" role="alert">
          Aucune information d'inscription disponible pour ce membre.
        </div>
      </ng-template>

      <hr class="my-4">
      <h4 class="mb-3 text-primary">Nouvelle Réinscription
        pour {{ member.personalInfo.firstname }} {{ member.personalInfo.name }}</h4>
      <button class="btn btn-outline-primary mb-3" *ngIf="!showReenrollmentForm" (click)="toggleReenrollmentForm()">
        <i class="bi bi-person-plus-fill"></i> Lancer une réinscription
      </button>

      <div *ngIf="showReenrollmentForm" class="card p-4 shadow-sm">
        <form [formGroup]="reinscriptionForm" novalidate (ngSubmit)="onReEnrollSubmit()">
          <div class="row gx-4 gy-3">
            <div class="col-md-4">
              <div class="form-group">
                <label for="reinscriptionSession" class="form-label">Session de Réinscription</label>
                <select id="reinscriptionSession" formControlName="session" class="form-control form-select-custom"
                        [ngClass]="{ 'is-invalid': reinscriptionForm.get('session')?.invalid && reinscriptionForm.get('session')?.touched }">
                  <option value="">Sélectionner une session</option>
                  <option *ngFor="let session of availableSessions" [value]="session.id">{{ session.session }}</option>
                </select>
                <div *ngIf="reinscriptionForm.get('session')?.invalid && reinscriptionForm.get('session')?.touched"
                     class="invalid-feedback">
                  Veuillez sélectionner une session.
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-group">
                <label class="form-label">Statut du Paiement</label>
                <div class="form-check form-switch form-switch-custom d-inline-block ms-3">
                  <input class="form-check-input" type="checkbox" id="reinscriptionStatusPayment"
                         formControlName="statusPayment" role="switch">
                  <label class="form-check-label" for="reinscriptionStatusPayment">Payé</label>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <label for="registrationType" class="form-label">Type D'Inscription</label>
              <select id="registrationType" formControlName="registrationType" class="form-control"
                      [ngClass]="{ 'is-invalid': personalInfo.get('registrationType')?.invalid && personalInfo.get('registrationType')?.touched }">
                <option value="" disabled selected>Sélectionnez</option>
                <option value="INITIAL">Initiale</option>
                <option value="REINSCRIPTION">Reinscription</option>
              </select>
            </div>
          </div>

          <div class="d-flex justify-content-end mt-4">
            <button class="btn btn-outline-primary me-2" type="submit" [disabled]="reinscriptionForm.invalid">
              <i class="bi bi-floppy2"></i> Enregistrer la réinscription
            </button>
            <button class="btn btn-secondary" type="button" (click)="cancelReenrollment()">
              Annuler
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="mt-4 text-center">
    <button class="btn btn-danger" (click)="deleteProfile()">
      <i class="bi bi-trash"></i> Supprimer le profil
    </button>
  </div>
</div>
