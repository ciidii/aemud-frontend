<div class="container mt-4">
  <h2 class="mb-3 fw-bold text-primary">Gestion des SMS</h2>

  <!-- Boutons d'action -->
  <div class="d-flex justify-content-between mb-4">
    <button class="btn btn-primary d-flex align-items-center" (click)="openSendModal()">
      <i class="bi bi-send me-2"></i> Envoyer un SMS
    </button>
    <button class="btn btn-success d-flex align-items-center" (click)="openScheduleModal()">
      <i class="bi bi-calendar-event me-2"></i> Programmer un SMS
    </button>
  </div>

  <!-- Affichage du solde des SMS -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body d-flex align-items-center justify-content-between">
      <div>
        <h5 class="card-title mb-0">Solde des SMS disponibles</h5>
        <p class="card-text text-muted">Nombre de SMS restants dans votre compte.</p>
      </div>
      <div class="d-flex align-items-center gap-3">
        <div class="display-4 fw-bold text-primary">
          {{ smsBalance }}
        </div>
        <button class="btn btn-outline-primary d-flex align-items-center" (click)="rechargeBalance()">
          <i class="bi bi-arrow-repeat me-2"></i> Recharger
        </button>
      </div>
    </div>
  </div>

  <!-- Tableau des SMS -->
  <div class="card shadow-sm">
    <div class="card-header bg-light fw-bold">Historique des SMS</div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
          <tr>
            <th scope="col" class="ps-4">Date</th>
            <th scope="col">Destinataire</th>
            <th scope="col">Message</th>
            <th scope="col">Statut</th>
            <th scope="col" class="text-end pe-4">Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let sms of paginatedSmsList" class="align-middle" (contextmenu)="deleteSms(sms.id, $event)">
            <td class="ps-4">{{ sms.date | date:'short' }}</td>
            <td>{{ sms.recipient }}</td>
            <td class="text-truncate" style="max-width: 300px;" title="{{ sms.message }}">{{ sms.message }}</td>
            <td>
                <span class="badge rounded-pill"
                      [ngClass]="{'bg-success': sms.status === 'Envoyé', 'bg-warning': sms.status === 'Programmé', 'bg-danger': sms.status === 'Échoué'}">
                  {{ sms.status }}
                </span>
            </td>
            <td class="text-end pe-4">
              <button class="btn btn-sm badge rounded-pill bg-danger" *ngIf="sms.status === 'Programmé'"
                      (click)="cancelSms(sms.id)">
                <i class="bi bi-x-circle"></i> Annuler
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <nav aria-label="Pagination" class="d-flex justify-content-center mt-4">
    <ul class="pagination">
      <li class="page-item" [ngClass]="{'disabled': currentPage === 1}">
        <a class="page-link" (click)="changePage(currentPage - 1)" aria-label="Précédent">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      <li *ngFor="let page of totalPagesArray()" class="page-item" [ngClass]="{'active': page === currentPage}">
        <a class="page-link" (click)="changePage(page)">{{ page }}</a>
      </li>
      <li class="page-item" [ngClass]="{'disabled': currentPage === totalPages}">
        <a class="page-link" (click)="changePage(currentPage + 1)" aria-label="Suivant">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>
</div>

<app-send-sms></app-send-sms>
<app-schedule-sms></app-schedule-sms>
