<div class="mandat-detail-page">
  <div *ngIf="isLoading" class="loading-container">
    <p>Chargement de la période de mandat...</p>
    <!-- Add more sophisticated skeleton loader here if needed -->
  </div>

  <div *ngIf="hasError && !isLoading" class="error-container">
    <p>La période de mandat n'a pas pu être chargée. Veuillez retourner à la liste.</p>
    <a routerLink="/periode-mandats/list">Retour à la liste</a>
  </div>

  <ng-container *ngIf="periodeMandat$ | async as periodeMandat">
    <div *ngIf="periodeMandat" class="mandat-content">
      <header class="page-header">
        <div class="header-content">
          <h1>{{ periodeMandat.nom }}</h1>
          <div class="header-meta">
            <span [class.active]="periodeMandat.estActif" [class.inactive]="!periodeMandat.estActif" class="status-badge">
              {{ periodeMandat.estActif ? 'Actif' : 'Inactif' }}
            </span>
            <div class="mandate-period">
              <div class="date-item">
                <small class="date-label date-label-debut">Début</small>
                <span class="date-value">{{ dateArrayToString(periodeMandat.dateDebut) | date: 'longDate' }}</span>
              </div>
              <div class="date-item">
                <small class="date-label date-label-fin">Fin</small>
                <span class="date-value">{{ dateArrayToString(periodeMandat.dateFin) | date: 'longDate' }}</span>
              </div>
            </div>
          </div>
        </div>
        <button (click)="goToEdit(periodeMandat.id)" class="btn-primary">Modifier la période de mandat</button>
      </header>

      <section class="timeline-section">
        <h2>Chronologie des phases</h2>
        <app-phase-timeline
          [periodeMandatEndDate]="dateArrayToString(periodeMandat.dateFin)"
          [periodeMandatStartDate]="dateArrayToString(periodeMandat.dateDebut)"
        >
        </app-phase-timeline>
      </section>

      <section class="phases-list-section">
        <h2>Détail des phases ({{ periodeMandat.phases.length }})</h2>
        <div class="phases-grid">
          <div *ngFor="let phase of periodeMandat.phases" [class.current-phase]="phase.id === currentPhaseId"
               class="phase-card">
            <div class="phase-card-header">
              <h3>{{ phase.nom }}</h3>
              <span *ngIf="phase.id === currentPhaseId" class="current-badge">En cours</span>
            </div>
            <div class="phase-card-body">
              <p class="phase-dates">
                {{ phase.dateDebut | arrayDate }} → {{ phase.dateFin | arrayDate }}
              </p>

              <p *ngIf="phase.dateDebutInscription">
                Inscriptions: {{ phase.dateDebutInscription | arrayDate }}
                → {{ phase.dateFinInscription | arrayDate }}
              </p>

            </div>
          </div>
        </div>
      </section>
    </div>
  </ng-container>
</div>
