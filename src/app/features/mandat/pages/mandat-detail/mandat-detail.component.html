<div class="mandat-detail-page">
  <div *ngIf="isLoading" class="loading-container">
    <p>Chargement du mandat...</p>
    <!-- Add more sophisticated skeleton loader here if needed -->
  </div>

  <div *ngIf="hasError && !isLoading" class="error-container">
    <p>Le mandat n'a pas pu être chargé. Veuillez retourner à la liste.</p>
    <a routerLink="/mandats/list">Retour à la liste</a>
  </div>

  <ng-container *ngIf="mandat$ | async as mandat">
    <div *ngIf="mandat" class="mandat-content">
      <header class="page-header">
        <div class="header-content">
          <h1>{{ mandat.nom }}</h1>
          <div class="header-meta">
            <span [class.active]="mandat.estActif" [class.inactive]="!mandat.estActif" class="status-badge">
              {{ mandat.estActif ? 'Actif' : 'Inactif' }}
            </span>
            <span class="mandate-period">
              {{ mandat.dateDebut | date: 'dd/MM/yyyy' }} → {{ mandat.dateFin | date: 'dd/MM/yyyy' }}
            </span>
          </div>
        </div>
        <button (click)="goToEdit(mandat.id)" class="btn-primary">Modifier le mandat</button>
      </header>

      <section class="timeline-section">
        <h2>Chronologie des phases</h2>
        <app-phase-timeline
          [mandateEndDate]="mandat.dateFin"
          [mandateStartDate]="mandat.dateDebut"
        >
        </app-phase-timeline>
      </section>

      <section class="phases-list-section">
        <h2>Détail des phases ({{ mandat.phases.length }})</h2>
        <div class="phases-grid">
          <div *ngFor="let phase of mandat.phases" [class.current-phase]="phase.id === currentPhaseId"
               class="phase-card">
            <div class="phase-card-header">
              <h3>{{ phase.nom }}</h3>
              <span *ngIf="phase.id === currentPhaseId" class="current-badge">En cours</span>
            </div>
            <div class="phase-card-body">
              <p class="phase-dates">
                {{ phase.dateDebut | arrayDate }} → {{ phase.dateFin | arrayDate }}
              </p>

              <p *ngIf="phase.dateDebutInscription">
                Inscriptions: {{ phase.dateDebutInscription | arrayDate }}
                → {{ phase.dateFinInscription | arrayDate }}
              </p>

            </div>
          </div>
        </div>
      </section>
    </div>
  </ng-container>
</div>
